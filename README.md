# 秘境集落探索ツール

## 概要
下記URLで公開している秘境集落探索ツールのソースコードです。  
<https://search-isolated-villages-2.herokuapp.com/>  
秘境集落を探索し、秘境度を人口分布データをもとに評価して地域別にランキングで出力します。  
集落のほか、下記の秘境施設も探索できます。
* 秘境郵便局
* 秘境小学校
* 秘境駅
* 秘境廃駅
* 秘境道の駅
* 秘境ニュータウン
* 秘境研究機関

## 主な利用データ
* E-statの国勢調査GISデータ<https://www.e-stat.go.jp/>
* 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>
* R774@まとめ屋さんの訪問先まとめマップデータ<http://umap.openstreetmap.fr/ja/map/r774_368811#5/36.297/139.680>

## ローカル環境での実行方法
1. 仮想環境を構築 ```pipenv install```
2. webサーバを起動 ```pipenv run python webif.py```
3. localhost:5000にアクセス

※Windows環境だとうまくいかないことがあるので、その場合は下記のDocker環境で実行する

## Docker環境での実行方法
1. コンテナ起動 ```docker-compose up -d```
2. コンテナに入る ```docker-compose exec hikyo bash```
3. コンテナ内でwebサーバを起動 ```pipenv run python webif.py```
4. localhost:5000にアクセス

## データの整備方法
本リポジトリはローカル環境で実行可能なよう整備されたデータが既に用意されているが、データを1から整備するには次の手順で行う。  
### 1. 生データの用意
* 郵便局データの用意
  1. 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>より、郵便局を選択
  2. 全国を選択してダウンロード（データ作成年度：平成25年度）
  3. ダウンロードしたファイルを`raw_data/post_office_shp`ディレクトリに格納
* 小学校データの用意
  1. 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>より、学校を選択
  2. 全国を選択してダウンロード（データ作成年度：平成25年度）
  3. ダウンロードしたファイルを`raw_data/elementary_school_shp`ディレクトリに格納
* 駅データの用意
  1. 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>より、鉄道を選択
  2. 令和元年の全国データを選択してダウンロード（データの基準となる年月日：令和元（2019）年12月31日時点）
  3. ダウンロードしたファイルを`raw_data/station_shp`ディレクトリに格納  
* 廃駅データの用意
  1. 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>より、鉄道時系列を選択
  2. 令和元年の全国データを選択してダウンロード（データ基準年月日：昭和25年1月1日からデータ整備年の12月31日の間に運行していた鉄道路線）
  3. ダウンロードしたファイルを`raw_data/abandoned_station_shp`ディレクトリに格納  
* 道の駅データの用意
  1. 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>より、道の駅を選択
  2. 全国を選択してダウンロード（データ作成年度：平成30年度（平成31年1月1日時点））
  3. ダウンロードしたファイルを`raw_data/michinoeki_shp`ディレクトリに格納
* ニュータウンデータの用意
  1. 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>より、ニュータウンを選択
  2. 全ての都道府県についてダウンロード（データ作成年度：平成25年度）
  3. ダウンロードしたファイルを`raw_data/new_town_shp`ディレクトリに格納
* 研究機関データの用意
  1. 国土数値情報ダウンロードサービス<http://nlftp.mlit.go.jp/ksj/>より、研究機関を選択
  2. 全ての都道府県についてダウンロード（データの基準年月日：「平成24（2012）年9月1日時点」）
  3. ダウンロードしたファイルを`raw_data/research_institute_shp`ディレクトリに格納
* R774@まとめ屋さんの訪問先まとめマップデータの用意
  1. <http://umap.openstreetmap.fr/ja/map/r774_368811#5/36.297/139.680>にアクセス
  2. 画面左のメニューより「サイトへのマップ埋め込みと共有」を選択
  3. geojson形式でデータをダウンロードし、`raw_data/r774_geojson`ディレクトリに格納

※その他に必要なメッシュ人口データ・メッシュ境界データ・小地域データは次の工程で自動的にダウンロードされる

### 2. Dockerで環境構築しデータ生成
1. コンテナ起動 ```docker-compose up -d```
2. コンテナに入る ```docker-compose exec hikyo bash```
3. ```make_input.sh```を実行

※4,5時間くらいかかる    
※inputディレクトリ下にcsvファイルが生成されていればOK

R774@まとめ屋さんの訪問先まとめマップデータを更新する際には、```make_input_r774.sh```を実行する


## 参考：メッシュ境界データ、人口データ、小地域データについて
* メッシュ境界データ
  * E-statホームページ（<https://www.e-stat.go.jp/>）の「統計GIS」→統計データダウンロード→境界データ→5次メッシュ→世界測地系緯度経度・Shape形式
* メッシュ人口データ
  * E-statホームページ（<https://www.e-stat.go.jp/>）の「統計GIS」→統計データダウンロード→統計データ→国勢調査→2015年→5次メッシュ→人口等基本集計に関する事項
* 小地域データ
  * E-statホームページ（<https://www.e-stat.go.jp/>）の「統計GIS」→統計データダウンロード→境界データ→小地域→国勢調査→2015年→小地域→世界測地系緯度経度・Shape形式
